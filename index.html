<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <!-- Resource links -->
    <link rel="stylesheet" type="text/css" href="resources/style.css">
    <title>Geocoding service</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      /* #map {
        height: 80%;
      } */
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /* #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }     */
      /* #map_canvas {
        height: 760px;
        width: 1100px;
        position: static;
        top: 100px;
        left: 200px;
    } */
    </style>
  </head>
  <body>
        <div class="split left" id="map-section"></div>

              <!-- <input type="text" id="search-field"></input>
              <button id="search-button">Submit</button>
              <br>
              <p>Popular searches: <span id="popular"></span></p> -->

            <div class="split right">
          
              <nav class="navbar navbar-dark bg-danger p-2">
                <a class="navbar-brand" href="#">
                  <b>Tube The Earth</b>
                </a>
                <!-- <form class="form-inline my-2 my-lg-0">
                  <input id="search-input" class="form-control mr-sm-2" type="search" placeholder="Search Location" aria-label="Search">
                  <button id="btn-search" class="btn btn-outline-light my-2 my-sm-0" type="submit">Tube</button>
                </form> -->
                <form class="form-inline my-2 my-lg-0">  
                  <div id="floating-panel">
                    <input id="address" type="textbox" placeholder="Portsmouth, NH">
                    <input id="submit" class="btn btn-outline-light my-2 my-sm-0" type="button" value="Geocode">
                  </div>
                </form>
                  <!-- <button id="btn-temp" class="btn btn-outline-light my-2 my-sm-0" type="button">Temp</button>
                  <input id="lat" type=text value="" placeholder="latitude">
                  <input id="long" type=text value="" placeholder="longitude"> -->
                  <form class="form-inline my-2 my-lg-0">
                    <h5>Search Radius (in miles)</h5>
                    <select id="rad" name="radius">
                      <option value="1">1</option>
                      <option value="5">5</option>
                      <option value="10" selected>10</option>
                      <option value="50">50</option>
                    </select>
                </form>
              </nav>
              <div class="card bg-dark" style="width:100%">
                <div class="row mx-auto"></div>
                <div class="mx-auto" style="width:100%">
          
                  <div class="videoWrapper" style="width:100%" id="videoIframe">
                    <iframe width="100%" src="https://www.youtube.com/embed/asgENCuBoKk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
          
                  </div>
                  <div class="row">
                    <ul class="nav nav-pills mx-auto" style="width:100%">
                      <li class="nav-item">
                        <a id="recently" class="nav-link bg-secondary text-light m-2" href="#">Additional Results</a>
                      </li>
                      <li class="nav-item">
                        <a id="history" class="nav-link text-dark bg-danger  m-2" href="#">History</a>
                      </li>
                    </ul>
                    <div id="additionalDiv" style="width:100%">
                      <div class="container bg-dark">
                        <div class="card bg-dark" style="width:100%">
                          <div id="cardThumb1">
                          <img class="card-img-top" id="cardThumb1" src="resources/img/img1_DSF9340-HDR.jpg" alt="Card image" alt="Thumbnail">
                          </div>
                          <div class="card-img-overlay">
                            <p class="card-text"><span id="youtubeTitle1">Lorem ipsum dolor sit amet</span></p>
                            <a href="#" id="youtubeLink1" class="btn btn-danger">46.414382,10.013988</a>
                          </div>
                        </div>
                        <div class="card bg-dark" style="width:100%">
                            <div id="cardThumb2">
                          <img class="card-img-top" id="cardThumb2" src="resources/img/IMG_7559.JPG" alt="Card image" alt="Thumbnail">
                          </div>
                          <div class="card-img-overlay">
                            <p class="card-text"><span id="youtubeTitle2">Pri ancillae epicurei et, stet ornatus ne mel, iusto fabellas mel in.</span> </p>
                            <a href="#" id="youtubeLink2" class="btn btn-danger">46.414382,10.013988</a>
                          </div>
                        </div>
                        <div class="card bg-dark" style="width:100%">
                            <div id="cardThumb3">
                          <img class="card-img-top" id="cardThumb3" src="resources/img/img2_DSCF6619.JPG" alt="Card image" alt="Thumbnail">
                          </div>
                          <div class="card-img-overlay">
                            <p class="card-text"><span id="youtubeTitle3">Mel graeci possim assueverit cu, an vim fugit omnes salutandi. Ea sale assum exerci quo, no lorem convenire
                              cotidieque est.</span></p>
                            <a href="#" id="youtubeLink3" class="btn btn-danger">46.414382,10.013988</a>
                          </div>
                        </div>
                        <div class="card bg-dark" style="width:100%">
                          <div id="cardThumb4">
                            <img class="card-img-top" id="cardThumb4" src="resources/img/img3_DSF8751-HDR.jpg" alt="Card image" alt="Thumbnail">
                        </div>
                          <div class="card-img-overlay">
                            <p class="card-text"><span id="youtubeTitle4">Vix eros adolescens id, ei alii erat vitae nec.</span></p>
                            <a href="#" id="youtubeLink4" class="btn btn-danger">46.414382,10.013988</a>
                          </div>
                        </div>
                      </div>
                    </div>
                      <div id="historyDiv" style="width:100%">
                        <p>Videos from your area: <span id="popular"></span></p>
                        <p>Recent searches: <span id="recent-searches"></span></p>
                        <span>
                          <img src="resources/img/youtube image.png" height="50px" alt="Thumbnail">
                          <caption>Random Title</caption>
                        </span>
                        <HR>
                        <span>
                          <img src="resources/img/youtube image.png" height="50px" alt="Thumbnail">
                          <caption>Random Title</caption>
                        </span>
                        <HR>
                        <span>
                          <img src="resources/img/youtube image.png" height="50px" alt="Thumbnail">
                          <caption>Random Title</caption>
                        </span>
                        <HR>
                        <span>
                          <img src="resources/img/youtube image.png" height="50px" alt="Thumbnail">
                          <caption>Random Title</caption>
                        </span>
                    </div>
                      <HR>
                    </div>
                  </div>
                </div>
              </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
      <script src="https://code.jquery.com/jquery.js"></script>
      <script src="firebase.js" type="text/javascript"></script>

    <script>
      
      var longi;
      var lati;
  
      function initMap() {
        
        var map = new google.maps.Map(document.getElementById('map-section'), {
          zoom: 8,
          center: {lat: 43.07167, lng: -70.76236}
        });

        var geocoder = new google.maps.Geocoder();
        console.log(map.center);
        google.maps.event.addListener(map, 'click', function(event) {
          placeMarker(event.latLng);
        });

        function placeMarker(location) {
            if (marker == undefined){
                marker = new google.maps.Marker({
                    position: location,
                    map: map, 
                    animation: google.maps.Animation.DROP,
                });
            }
            else{
                marker.setPosition(location);
            }
            map.setCenter(location);
            console.log(location.lat());//this is where latitude is being console logged
            console.log(location.lng());//longitude
        }

        document.getElementById('submit').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
          console.log(geocoder);
          console.log(map);
          console.log(map.center.lat());
          console.log(map.center.lng());
          longi = map.center.lng();
          lati = map.center.lat();
          //debugger;
          // var latitude = $("#lat").val().trim();
          // var longitude = $("#long").val().trim();
          var radius = $("#rad").val().trim();

          var queryURL = "https://www.googleapis.com/youtube/v3/search?type=video&part=snippet&location=" + lati + "," + longi + "&locationRadius=" + radius + "miles&key=AIzaSyC3hyycsztOR8N1flGac1ocYQF1PGt6F6M";
          console.log(lati);
          console.log(longi);
          $.ajax({
          url: queryURL,
          method: "GET"
          })
          
          .then(function(response) {
            var results = response.data;
            console.log(response);
            console.log(response.pageInfo.totalResults);
            if (response.pageInfo.totalResults !== 0) {
              for (var i = 0; i < response.items.length; i++) {             

                console.log(response);
                console.log(response.items[i].id.videoId);
                
                $("#cardThumb" + [i]).html("<img class='card-img-top' src=" + response.items[i].snippet.thumbnails.high.url + "> ");
                $("#youtubeLink" + [i]).html("<a href='https://www.youtube.com/watch?v=" + response.items[i].id.videoId + "' class='btn btn-danger'>" + response.items[i].snippet.channelTitle + "</a>");
                $("#youtubeTitle" + [i]).html(response.items[i].snippet.title);
                $("#videoIframe").html("<iframe width='100%' src='https://www.youtube.com/embed/" + response.items[0].id.videoId + "' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe>");
              }
            } else {
                alert("no results!");
              };
            });
          });
      };
      
      console.log(longi);
        
      function geocodeAddress(geocoder, resultsMap) {
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
          console.log(address);
          console.log(results[0].geometry.location.lat());
          console.log(results[0].geometry.location.lng());
        });
      }

      var marker;

      function initialize() {
          var latlng = new google.maps.LatLng(42.55308, 9.140625);
          var myOptions = {
              zoom: 2,
              center: latlng,
              mapTypeId: google.maps.MapTypeId.ROADMAP,
              streetViewControl: false,
              mapTypeControl: false,
          };
          var map = new google.maps.Map(document.getElementById("map_canvas"),
                  myOptions);
      };

      $("#history").on("click", function() {
        $("#additionalDiv").css("display", "none")
        $("#historyDiv").css("display", "block")
      });
      $("#recently").on("click", function() {
          $("#historyDiv").css("display", "none")
          $("#additionalDiv").css("display", "block")
      });

      $("#btn-temp").on("click", function() {
        
        });
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPJY8PEhnSLeidBniCMbet80SlznQUFvM&callback=initMap">
    </script>
  </body>
</html>